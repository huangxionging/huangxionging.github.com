<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.2.1 (452715)"/><meta name="altitude" content="23.09149551391602"/><meta name="author" content="Redman"/><meta name="created" content="2015-05-27 08:59:54 +0000"/><meta name="latitude" content="22.54698971172465"/><meta name="longitude" content="113.9366238317681"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2015-05-28 08:37:05 +0000"/><title>裁剪图片</title></head><body>
<div><span style="font-family: Menlo;">// 裁剪算法描述</span></div>
<div><span style="font-family: Menlo;">1. 获取图片</span></div>
<div><span style="font-family: Menlo;">2. 设置颜色空间</span></div>
<div><span style="font-family: Menlo;">3. 获取绘图设备环境</span></div>
<div><span style="font-family: Menlo;">4. 设计裁剪规则</span></div>
<div><span style="font-family: Menlo;">5. 将图片写入设备环境</span></div>
<div><span style="font-family: Menlo;">6. 从设备环境获取裁剪后的图像</span></div>
<div><span style="font-family: Menlo;"><br/></span></div>
<div><span style="font-family: Menlo;"><br/></span></div>
<div><span style="font-family: Menlo;">// 裁剪矩形</span></div>
<div><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">- (</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIImage</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">*) clipImageWith: (</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">NSString</span><span style="font-family: Menlo;">*)fileName {</span></div>
<div><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIImage</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">*image = [</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIImage</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">imageNamed</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">: fileName];<br/>
   <br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGColorSpaceRef</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">colorRef =</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGColorSpaceCreateDeviceRGB</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">();<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGContextRef</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">ctx =</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGBitmapContextCreate</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">nil</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, image.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">width</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, image.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">height</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, 8, image.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">width</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">* 4, colorRef, (</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGBitmapInfo</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">)</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">kCGImageAlphaPremultipliedFirst</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">);<br/>
    </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGContextClipToRect</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(ctx,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGRectMake</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(0, 0, 100, 100));<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGContextDrawImage</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(ctx,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGRectMake</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(0, 0, image.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">width</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, image.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">height</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">), image.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGImage</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">);<br/>
   <br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGImageRef</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">imageRef =</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGBitmapContextCreateImage</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(ctx);<br/>
   <br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIImage</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">*imageDst = [</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIImage</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">imageWithCGImage</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">: imageRef</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">scale</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">: [</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIScreen</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">mainScreen</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">].</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">scale</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">orientation</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIImageOrientationUp</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">];<br/>
   <br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">return</span> <span style="font-style: normal; font-variant: normal; font-weight: normal;"><span style="font-family: Menlo;">imageDst;</span></span></div>
<div><span style="font-family: Menlo;">}</span></div>
<div><span style="font-family: Menlo;"><br/></span></div>
<div><span style="font-family: Menlo;"><br/></span></div>
<div><span style="font-family: Menlo;">// 利用 path 来裁剪 效果图  </span><img src="%E8%A3%81%E5%89%AA%E5%9B%BE%E7%89%87.resources/A270B774-DDE5-4783-9F4E-5F602D2294E6.png" height="167" width="372"/></div>
<div><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">- (</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIImage</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">*)clipImageWithPoints:(</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">NSArray</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">*)pointArray andBitPerComponent: (</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size_t</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">) bitsPerComponent {<br/>
   <br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">颜色空间</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGColorSpaceRef</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">colorRef =</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGColorSpaceCreateDeviceRGB</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">();<br/>
   <br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">绘图环境</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGContextRef</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">ctx = </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGBitmapContextCreate</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">nil</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">self</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">width</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">self</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">height</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, bitsPerComponent,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">self</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">width</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">* 4, colorRef, (</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGBitmapInfo</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">)</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">kCGImageAlphaPremultipliedFirst</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">);<br/>
   <br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">路径</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGMutablePathRef</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">path =</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGPathCreateMutable</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">();<br/>
   <br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">起始点</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGPoint</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">start =</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGPointZero</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">;<br/>
<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">绘制路径</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">for</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">NSInteger</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">index = 0; index &lt; pointArray.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">count</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">; ++index) {<br/>
       </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">NSAssert</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">([pointArray[index]</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">respondsToSelector</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">@selector</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(CGPointValue)],</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #b4261a">@"</span><span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #b4261a">不能获得点</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #b4261a">"</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">);<br/>
       <br/>
       </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGPoint</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">point = [pointArray[index]</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGPointValue</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">];<br/>
       <br/>
       </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">if</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(index == 0) {<br/>
           </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGPathMoveToPoint</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(path,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">NULL</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, point.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">x</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, point.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">y</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">);<br/>
            start = point;<br/>
        }<br/>
       </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">else</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">{<br/>
           </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGPathAddLineToPoint</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(path,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">NULL</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, point.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">x</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, point.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">y</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">);<br/>
        }<br/>
    }<br/>
   <br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">绘制最后一条线</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGPathAddLineToPoint</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(path,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">NULL</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, start.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">x</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">, start.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">y</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">);<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">关闭路径</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGPathCloseSubpath</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(path);<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">将路径添加至设备环境</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGContextAddPath</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(ctx, path);<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">裁剪设备环境</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGContextClip</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(ctx);<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">释放路径</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGPathRelease</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(path);<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">将图像写入设备环境</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGContextDrawImage</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(ctx,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGRectMake</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(0, 0,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">self</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">width</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">,</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">self</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">size</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">height</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">),</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">self</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGImage</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">);<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">获取裁剪后的图像</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGImageRef</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">imageRef =</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGBitmapContextCreateImage</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(ctx);<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">释放颜色空间</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">CGColorSpaceRelease</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">(colorRef);<br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">//</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">获取</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #008f00">UIImage</span> <span style="font: 18.0px 'Heiti SC Light'; font-variant-ligatures: no-common-ligatures; color: #008f00">类型图像</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIImage</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">*imageDst = [</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIImage</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">imageWithCGImage</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">: imageRef</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">scale</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">: [</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIScreen</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">mainScreen</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">].</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">scale</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">orientation</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #3495af">UIImageOrientationUp</span><span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures">];<br/>
   <br/>
   </span> <span style="font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #0433ff">return</span> <span style="font-style: normal; font-variant: normal; font-weight: normal;"><span style="font-family: Menlo;">imageDst;<br/>
<br/></span></span></div>
<div><span style="font-family: Menlo;">}</span></div>
<div><span style="font-family: Menlo;"><br/></span></div>
<div><span style="font-family: Menlo;">// 需要注意的是, CoreGraphics 的坐标系 y 轴向上, 与 UIKit 坐标系相反.</span></div>
<div><br/></div>
<div><br/></div>
</body></html>